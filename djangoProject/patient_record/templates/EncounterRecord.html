{% extends "baseTemplate.html" %}
{% load static %}
{% block page_css %}
    <link rel="stylesheet" href="{% static 'css/patientRecord.css' %}">
{% endblock %}

{% block content %}
<h1>Encounter Record</h1>

<div class="flex-container">
    <!-- Add Encounter Section -->
    <div class="add_background">
        <h1>Add Encounter</h1>
        <form method="POST" action="{% url 'encounterRecord' %}">
            {% csrf_token %}
            {{ add_form.as_p }}
            <input type="hidden" name="add_encounter" value="True">
            <button type="submit">Submit</button>
        </form>
    </div>

    <!-- View and Edit Encounter Section -->
    <div class="add_background">
        <h1>View Encounter</h1>
        <form method="GET" action="{% url 'encounterRecord' %}">
            {{ search_form.as_p }}
            <button type="submit">Search / Select</button>
        </form>

        {% if selected_encounter %}
            <h3>Selected Encounter Details</h3>
            <form method="POST" action="{% url 'encounterRecord' %}">
                {% csrf_token %}
                <input type="hidden" name="selected_encounter_id" value="{{ selected_encounter.encounterid }}">

                {% if edit_mode and edit_form %}
                    <!-- Edit Mode: Editable Fields -->
                    {{ edit_form.as_p }}

                    <button type="submit" name="save_changes" value="True">Save Changes</button>
                    <button type="submit" name="delete" value = "True">Delete Encounter</button>
                {% else %}
                    <!-- View Mode: Read-Only Details -->
                    <p><strong>ID:</strong> {{ selected_encounter.encounterid }}</p>
                    <p><strong>Patient Name:</strong> {{ selected_encounter.patientid }}</p>
                    <p><strong>Physician Name:</strong> {{ selected_encounter.physicianid }}</p>
                    <p><strong>Patient Complaints:</strong> {{ selected_encounter.patientcomplaints }}</p>
                    <p><strong>Practitioner Notes</strong> {{ selected_encounter.practitionernotes }}</p>
                {% endif %}

                    <!-- Toggle Edit Mode Back Off-->
                    <input type="hidden" name="edit_mode" value="{% if edit_mode %}False{% else %}True{% endif %}">
                    <button type="submit">{{ edit_mode|yesno:"Cancel,Edit" }}</button>
            </form>
        {% else %}
            <p>No encounter selected yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}